{% extends 'layout/base.html' %}

{% block title %}Tìm Chuyến Bay{% endblock %}

{% block content %}
<!-- Form Tìm Chuyến Bay -->
<div class="container mt-5">
    <h2 class="text-center">Tìm Chuyến Bay</h2>

    <!-- Form Tìm Chuyến Bay -->
    <form method="POST" action="/tim-chuyen-bay">
        <div class="row">
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="sanBayDi" class="form-label">Sân bay đi</label>
                    <select class="form-select" id="sanBayDi" name="sanBayDi" required>
                        {% if data==null %}
                        <option value="" disabled selected>Chọn sân bay đi</option>
                        {% endif %}
                        {% for sanBay in sanBays %}
                        {% if sanBay.maSanBay == data.get('sanBayDi', '') %}
                        <option value="{{ sanBay.maSanBay }}" selected>{{ sanBay.tenSanBay }}</option>
                        {% else %}
                        <option value="{{ sanBay.maSanBay }}">{{ sanBay.tenSanBay }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="mb-3">
                    <label for="sanBayDen" class="form-label">Sân bay đến</label>
                    <select class="form-select" id="sanBayDen" name="sanBayDen" required>
                        {% if data==null %}
                        <option value="" disabled selected>Chọn sân bay đến</option>
                        {% endif %}
                        {% for sanBay in sanBays %}
                        {% if sanBay.maSanBay == data.get('sanBayDen', '') %}
                        <option value="{{ sanBay.maSanBay }}" selected>{{ sanBay.tenSanBay }}</option>
                        {% else %}
                        <option value="{{ sanBay.maSanBay }}">{{ sanBay.tenSanBay }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="mb-3">
                    <label for="ngayDi" class="form-label">Ngày đi</label>
                    <input type="date" class="form-control" id="ngayDi" name="ngayDi" required value="{{ data.get('ngayDi', '') }}">
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Tìm Chuyến Bay</button>
    </form>
</div>

<!-- Hiển thị kết quả chuyến bay -->
<div class="container mt-5">
    <h3 class="text-center">Danh Sách Chuyến Bay</h3>
    {% if chuyenBays %}
    <div class="row">
        {% for chuyenBay in chuyenBays %}
        <div class="col-md-4 mb-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Chuyến bay: {{ chuyenBay.maChuyenBay }}</h5>
                    <p class="card-text"><strong>Tuyến bay:</strong> {{ chuyenBay.tuyenBay.tenTuyenBay }}</p>
                    <p class="card-text"><strong>Giờ đi:</strong> {{ chuyenBay.gioDi.strftime("%H:%M, %d/%m/%Y") }}</p>
                    <p class="card-text"><strong>Giờ đến:</strong> {{ chuyenBay.gioDen.strftime("%H:%M, %d/%m/%Y") }}</p>
                    <p class="card-text"><strong>Máy bay:</strong> {{ chuyenBay.mayBay.tenMayBay }}</p>
                    <!-- Nút Đặt Vé -->
                    {% if current_user.is_authenticated %}
                    <a href="{{ url_for('dat_ve', ma_chuyen_bay=chuyenBay.maChuyenBay) }}" class="btn btn-success">Đặt Vé</a>
                    {% else %}
                    <p>Vui lòng <a href="/login?next=/tim-chuyen-bay">đăng nhập</a> để đặt vé!</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-warning" role="alert">
        Không có chuyến bay phù hợp với tiêu chí tìm kiếm của bạn.
    </div>
    {% endif %}
</div>
{% endblock %}
